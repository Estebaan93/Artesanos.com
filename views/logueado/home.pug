//-views/logueado/home.pug
extends ../layouts/logueado

block headExtra 
  link(rel="stylesheet", href="/css/explorerPublico.css")

block content
  //- SECCIÓN EVENTOS
  if eventos && eventos.length
    h2 Eventos destacados
    .home-cards-container
      each evento in eventos
        .home-card
          h3= evento.titulo
          p= evento.descripcion
          if evento.fecha
            p Fecha: #{evento.fecha}
  else
    p.mensaje-alerta No hay eventos para mostrar.

  //- SECCIÓN ÁLBUMES PÚBLICOS DE USUARIOS
  h2 Álbumes públicos de la comunidad

  if albumesPublicos && albumesPublicos.length
    .home-cards-container
      each album in albumesPublicos
        .home-card
          h3
            | #{album.titulo} 
            small por 
              a(href=`/portafolio/${album.autor_id}`)= album.autor_nombre + " " + album.autor_apellido
          if !album.imagenes || album.imagenes.length === 0
            p Sin imágenes públicas.
          else
            .imagenes-grid
              each img in album.imagenes
                - const srcImg = img.imagen.startsWith('http') ? img.imagen : `/img/obras/${img.imagen}`
                .img-con-comentarios
                  img.imagen-clickable(
                    src=srcImg,
                    alt=img.titulo,
                    data-usuario=`${album.autor_nombre} ${album.autor_apellido}`,
                    data-titulo=img.titulo
                  )
                //- Comentarios y formulario (solo logueado, ¡y este home es para logueados!)
                if img.comentarios && img.comentarios.length
                  ul.comentarios
                    each com in img.comentarios
                      li
                        strong= com.usuario
                        | : #{com.descripcion}
                //- Formulario para comentar
                form(
                  method="POST",
                  action=`/imagen/${img.id_imagen}/comentario`,
                  class="form-comentar"
                )
                  textarea(name="descripcion" required placeholder="Agregar un comentario…")
                  button(type="submit") Comentar
  else
    p.mensaje-alerta No hay álbumes públicos en este momento.

  script(src="/js/modalImagen.js")
  script(src="/js/homeIndex.js")     